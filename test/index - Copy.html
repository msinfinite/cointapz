<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
	
    <title>Random Movie Generator (1980-Present)</title>
    <style>
	
	
	
	.loading {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  background-color: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(5px);
  z-index: 9999;
}

.loading img {
  width: 50px;
  height: 50px;
  margin-bottom: 10px;
}

.loading::after {
  content: 'Loading...';
  color: #ffffff;
  font-size: 18px;
}

body.loading-active {
  overflow: hidden;
}

	
	
	
	
	
	
	


.option-label {
  display: block;
  margin-bottom: 10px;
  font-size: 16px;
  font-weight: bold;
  color: #b3b3b3;
}

#show-type {
  display: flex;
  background-color: #2a2a2a;
  border-radius: 5px;
  overflow: hidden;
}

.radio-container {
  flex: 1;
/*  position: relative;   */
}

.radio-container input[type="radio"] {
  display: none;
}

.radio-container label {
    border: 2px solid #313131;
  display: block;
  padding: 10px 15px;
  text-align: center;
  color: #ffffff;
  cursor: pointer;
  transition: background-color 0.3s ease, color 0.3s ease;
}

.radio-container input[type="radio"]:checked + label {
  background-color: #4a90e2;
  color: #ffffff;
}

.radio-container label:hover {
  background-color: #3a3a3a;
}

.radio-container::after {
  content: '';
  position: absolute;
  top: 50%;
  right: 0;
  transform: translateY(-50%);
  width: 1px;
  height: 60%;
  background-color: #3a3a3a;
}

.radio-container:last-child::after {
  display: none;
}

/* Animation for the selected state */
.radio-container input[type="radio"] + label::before {
  content: '';
  position: absolute;
  top: 0;
  left: 50%;
  width: 0;
  height: 3px;
  background-color: #4a90e2;
  transition: width 0.3s ease, left 0.3s ease;
}

.radio-container input[type="radio"]:checked + label::before {
  width: 100%;
  left: 0;
}

	
	
	
	
	
	
	
#search-options {
  border: 2px solid #4a4a4a;
  border-radius: 8px;
/*  padding: 20px;  */
  margin: 20px 0;    
  background-color: #2a2a2a;
}

#search-options legend {
  width: 100%;
  padding: 0;
}

#search-options h2 {
  text-align: center;
  color: #ffffff;
  font-size: 24px;
  margin: 0;
  padding: 10px 0;
  cursor: pointer;
  user-select: none;
}

.toggle-icon {
  margin-left: 10px;
  transition: transform 0.3s ease;
  display: inline-block;
}

.fieldset-content {
  max-height: 1000px; /* Adjust this value based on your content */
  overflow: hidden;
  transition: max-height 0.3s ease;
}

#search-options:not(.collapsed) .toggle-icon {
  transform: rotate(180deg);
}

.collapsed .fieldset-content {
  max-height: 0;
}





	
	
	
	
	
	
	
	
.option {
  margin: 20px;
}

label {
display: flex;

  margin-bottom: 8px;
  font-size: 16px;
  font-weight: bold;
  color: #b3b3b3;
}

.select-wrapper {
  position: relative;
  width: 200px;

}

select {
  appearance: none;
  -webkit-appearance: none;
  width: 100%;
  padding: 10px 15px;
  font-size: 16px;
  background-color: #2a2a2a;
  color: #ffffff;
  border: 2px solid #3a3a3a;
  border-radius: 5px;
  cursor: pointer;
  transition: all 0.3s ease;

}

select:hover, select:focus {
  border-color: #4a90e2;
  box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
  outline: none;
}

/* Custom arrow styling */
.select-wrapper::after {
  content: '\25BC';
  position: absolute;
  top: 50%;
  right: 15px;
  transform: translateY(-50%);
  pointer-events: none;
  font-size: 12px;
  color: #ffffff;
  transition: transform 0.3s ease;
}

.select-wrapper:hover::after {
  transform: translateY(-50%) rotate(180deg);
}

/* Styling for dropdown options */
select option {
  background-color: #2a2a2a;
  color: #ffffff;
  padding: 10px 15px;
  margin: 5px 0;

}

/* Hide default arrow in IE */
select::-ms-expand {
  display: none;
}

/* Increase spacing between options (for Chrome and modern browsers) */
select {
  padding: 10px 15px;
}

/* For Firefox */
select {
  -moz-appearance: none;
  text-indent: 0.01px;
  text-overflow: '';
}

/* For non-Webkit browsers */
select {
  background-image: linear-gradient(45deg, transparent 50%, #ffffff 50%),
                    linear-gradient(135deg, #ffffff 50%, transparent 50%);
  background-position: calc(100% - 20px) calc(1em + 2px),
                       calc(100% - 15px) calc(1em + 2px);
  background-size: 5px 5px,
                   5px 5px;
  background-repeat: no-repeat;
}






	
	
	
	
	h2 {
	  font-family: "Jost", sans-serif;
  font-optical-sizing: auto;
  font-weight: <weight>;
  font-style: normal;
	}
	
	.logo {
	padding-bottom: 2rem;
	}
	
	
	#search-options {
  max-width: 600px;
  margin: 0 auto;

}

.option {
  margin-bottom: 15px;
      padding: 1rem;
}

#year-range {
  display: flex;
  align-items: center;
  justify-content: center;
}

#year-range input[type="range"] {
  width: 200px;
  margin: 0 10px;
}

#search-button {
  margin-top: 20px;
  padding: 10px 20px;
  font-size: 16px;
}

#search-results {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 20px;
  margin-top: 30px;
}
#movie-container {
display: flex;
    flex-wrap: wrap;
    justify-content: center;
	
	}

.search-result {
  width: 200px;
  text-align: center;
}

.search-result img {
  max-width: 100%;
  height: auto;
}

	
	
	
        body {
            font-family: Arial, sans-serif;
            background-color: #202124;
            color: #ffffff;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
        }
        button {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            font-size: 18px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        .movie-info {
            background-color: #2a2a2a;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .movie-poster {
            max-width: 300px;
            display: block;
            margin: 0 auto;
			border-radius: 0.5rem;
        }
        .movie-title {
            font-size: 24px;
            font-weight: bold;
            margin-top: 10px;
        }
        .movie-details {
            margin-top: 10px;
        }
    .stars {
        display: inline-block;
        font-size: 24px;
        line-height: 1;
    }
    .star {
        color: #ddd;  /* Gray color for empty stars */
    }
    .star.filled {
        color: gold;  /* Gold color for filled stars */
    }
        .financial-box {
            border: 1px solid #444;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
        }
        .profit.positive {
            color: green;
        }
        .profit.negative {
            color: red;
        }
        .overview {
            border: 1px solid #444;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
        }
        .cast-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
        }
        .cast-member {
            width: 100px;
            margin: 10px;
            text-align: center;
        }
        .cast-member img {
            width: 100px;
            height: 100px;
            object-fit: cover;
			border-radius: 5rem;
        }
        .backdrop-container {
            display: flex;
            overflow-x: auto;
            margin-top: 20px;
        }
        .backdrop {
            max-width: 200px;
            margin-right: 10px;
            cursor: pointer;
        }
        .recommendations {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
        }
        .recommendation {
            width: 150px;
            margin: 10px;
            text-align: center;
            cursor: pointer;
        }
        .recommendation img {
            max-width: 100%;
			border-radius: 0.5rem;
        }

        .expanded-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .expanded-backdrop img {
            max-width: 90%;
            max-height: 90%;
        }
		.castcharacter {
		font-size: small;
		}
    </style>
</head>
<body>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const radioContainers = document.querySelectorAll('.radio-container');

  radioContainers.forEach(container => {
    const radio = container.querySelector('input[type="radio"]');
    const label = container.querySelector('label');

    label.addEventListener('click', function() {
      radioContainers.forEach(c => c.classList.remove('checked'));
      container.classList.add('checked');
    });
  });
});
</script>


<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchOptions = document.getElementById('search-options');
  const toggleIcon = searchOptions.querySelector('.toggle-icon');
  const h2 = searchOptions.querySelector('h2');

  h2.addEventListener('click', function() {
    searchOptions.classList.toggle('collapsed');
  });
});
</script>


<img src="logo.svg" class="logo">


<div id="main-form">
<fieldset id="search-options">
  <legend>
    <h2>
      Search Movies and TV Shows
      <span class="toggle-icon">&#9660;</span>
    </h2>
  </legend>
  <div class="fieldset-content">
    <!-- Your existing content goes here -->
	


  
  <div class="option">
    <label for="genre" >Genre:</label>
    <select id="genre" >
      <option value="" >All Genres</option>
    </select>
  </div>

  <div class="option">
    <label>Release Year:</label>
    <div id="year-range">
      <input type="range" id="year-min" min="1980" max="2024" value="1980">
      <input type="range" id="year-max" min="1980" max="2024" value="2024">
      <span id="year-display">1980 - 2024</span>
    </div>
  </div>

  <div class="option">
    <label for="user-rating">Minimum Rating:</label>
    <select id="user-rating">
      <option value="1">All</option>
      <option value="2">+2 Stars</option>
      <option value="3">+3 Stars</option>
      <option value="4">+4 Stars</option>
    </select>
  </div>

<div class="option">
  <label class="option-label">Show Type:</label>
  <div id="show-type">
    <div class="radio-container">
      <input type="radio" id="all" name="show-type" value="all" checked>
      <label for="all">All</label>
    </div>
    <div class="radio-container">
      <input type="radio" id="movies" name="show-type" value="movie">
      <label for="movies">Movies</label>
    </div>
    <div class="radio-container">
      <input type="radio" id="tv" name="show-type" value="tv">
      <label for="tv">TV Shows</label>
    </div>
  </div>
</div>


  <button id="search-button">Search</button>
</div>



		
        <button id="generateButton" onclick="handleGenerateClick()">Generate Random Movie</button>
		
		
		
		
		
		
		
		

  </div>
	</fieldset>		
		<div id="search-results"></div>
		
        <div id="movie-container"></div>


<div id="loading" class="loading" style="display: none;">
  <img src="loading.svg" alt="Loading">
</div>
				

    </div>
	
	
	<script>
	function showLoading() {
  document.getElementById('loading').style.display = 'flex';
  document.body.classList.add('loading-active');
}

function hideLoading() {
  document.getElementById('loading').style.display = 'none';
  document.body.classList.remove('loading-active');
}

	</script>


<script>
// reload page everytime loading appears

function handleLoadingState(isLoading) {
    const loadingElement = document.getElementById('loading');
    const movieContainer = document.getElementById('movie-container');
    const searchResults = document.getElementById('search-results');

    if (isLoading) {
        // Show loading and clear results
        loadingElement.style.display = 'block';
        movieContainer.innerHTML = '';
        searchResults.innerHTML = '';
    } else {
        // Hide loading
        loadingElement.style.display = 'none';
    }
}
</script>
<script>
// Global variables
let lastSearchTime = 0;
const yearMin = document.getElementById('year-min');
const yearMax = document.getElementById('year-max');
const yearDisplay = document.getElementById('year-display');

// Event listeners
window.addEventListener('load', fetchGenres);
document.getElementById('search-button').addEventListener('click', handleSearch);
yearMin.addEventListener('input', updateYearDisplay);
yearMax.addEventListener('input', updateYearDisplay);

// Fetch genres and populate dropdown
function fetchGenres() {
  fetch('get_genres.php')
    .then(response => response.json())
    .then(data => {
      populateGenreDropdown(data);
    })
    .catch(error => console.error('Error fetching genres:', error));
}


function populateGenreDropdown(genres) {
  const genreSelect = document.getElementById('genre');
  genres.forEach(genre => {
    const option = document.createElement('option');
    option.value = genre.id;
    option.textContent = genre.name;
    genreSelect.appendChild(option);
  });
}

// Update year display
function updateYearDisplay() {
  const minValue = parseInt(yearMin.value);
  const maxValue = parseInt(yearMax.value);
  
  if (minValue > maxValue) {
    yearMax.value = minValue;
  }
  
  yearDisplay.textContent = `${yearMin.value} - ${yearMax.value}`;
}






// Handle search
// Assuming you have these elements defined
const loadingElement = document.getElementById('loading');
const searchButton = document.getElementById('search-button');

function handleSearch() {
  const now = Date.now();
  if (now - lastSearchTime < 30000) {
    alert('Please wait 30 seconds before searching again.');
    return;
  }
  lastSearchTime = now;
  searchMedia();
}

function searchMedia() {
    handleLoadingState(true); // Add this line at the beginning
  // Show loading indicator
  loadingElement.style.display = 'block';
  searchButton.disabled = true; // Disable the search button while loading

  const genre = document.getElementById('genre').value;
  const minYear = yearMin.value;
  const maxYear = yearMax.value;
  const minRating = document.getElementById('user-rating').value;
  const showType = document.querySelector('input[name="show-type"]:checked').value;

  // Check if any filters have been changed
  const isDefaultSearch = (
    genre === '' &&
    minYear === '1980' &&
    maxYear === '2024' &&
    minRating === '1' &&
    showType === 'all'
  );

  const url = `search_media.php?genre=${genre}&min_year=${minYear}&max_year=${maxYear}&min_rating=${minRating}&show_type=${showType}&default=${isDefaultSearch}`;

  fetch(url)
    .then(response => response.json())
    .then(data => {
      displaySearchResults(data);
    })
    .catch(error => {
      console.error('Error:', error);
      document.getElementById('search-results').innerHTML = '<p>An error occurred while searching. Please try again.</p>';
    })
    .finally(() => {
      // Hide loading indicator and re-enable search button
      loadingElement.style.display = 'none';
      searchButton.disabled = false;
    });
}

// Function to generate star rating (make sure this is defined in your code)
function generateStarRating(rating) {
    const starTotal = 5;
    const fullStars = Math.round(rating / 2);
    return `<span class="stars">${'<span class="star filled">★</span>'.repeat(fullStars)}${'<span class="star">★</span>'.repeat(starTotal - fullStars)}</span>`;
}

function displaySearchResults(results) {
    const container = document.getElementById('search-results');
    container.innerHTML = ''; // Clear previous results

    // Clear random movie result
    document.getElementById('movie-container').innerHTML = '';

    if (results.length === 0) {
        container.innerHTML = '<p>No results found.</p>';
        return;
    }

    results.forEach(item => {
        const element = document.createElement('div');
        element.className = 'search-result';
        element.innerHTML = `
            <img src="${item.poster}" alt="${item.title}">
            <h3>${item.title}</h3>
            <p>Release Date: ${item.release_date}</p>
            <p>Rating: 
                ${generateStarRating(item.vote_average)}
                (${item.vote_average.toFixed(1)}/10)
            </p>
        `;
        element.addEventListener('click', () => getMovieDetails(item.id));
        container.appendChild(element);
    });
}



</script>
    <script>
	
	//random search
        let lastGenerateTime = 0;
        let generateCount = 0;
        let generateCountResetTime = 0;

        function handleGenerateClick() {
            const now = Date.now();
            if (now - lastGenerateTime < 30000) {
                alert('Please wait 30 seconds before generating another movie.');
                return;
            }
            if (now - generateCountResetTime > 3600000) {
                generateCount = 0;
                generateCountResetTime = now;
            }
            if (generateCount >= 10) {
                alert('You have reached the limit of 30 generates per hour.');
                return;
            }

            lastGenerateTime = now;
            generateCount++;

            getRandomMovie();
        }

        function getRandomMovie() {
		    handleLoadingState(true); // Add this line at the beginning
			
            const loadingElement = document.getElementById('loading');
            const movieContainer = document.getElementById('movie-container');
            
            loadingElement.style.display = 'block';
            movieContainer.innerHTML = '';

            fetch('get_random_movie.php')
                .then(response => response.json())
                .then(data => {
                    loadingElement.style.display = 'none';
                    displayMovieData(data);
                })
                .catch(error => {
                    console.error('Error:', error);
                    loadingElement.style.display = 'none';
                    movieContainer.innerHTML = '<p>An error occurred. Please try again.</p>';
                });
        }

        function getMovieDetails(movieId) {
    handleLoadingState(true); // Add this line at the beginning

			
            const loadingElement = document.getElementById('loading');
            const movieContainer = document.getElementById('movie-container');
            
            loadingElement.style.display = 'block';
            movieContainer.innerHTML = '';

            fetch(`get_movie_details.php?id=${movieId}`)
                .then(response => response.json())
                .then(data => {
                    loadingElement.style.display = 'none';
                    displayMovieData(data);
                })
                .catch(error => {
                    console.error('Error:', error);
                    loadingElement.style.display = 'none';
                    movieContainer.innerHTML = '<p>An error occurred. Please try again.</p>';
                });
				
        }

function displayMovieData(data) {

    const movieContainer = document.getElementById('movie-container');
    movieContainer.innerHTML = `
                <div class="movie-info">
                    <img src="${data.poster}" alt="${data.title}" class="movie-poster">
                    <div class="movie-title">${data.title}</div>
                    <div class="movie-details">
                        <p>Release Date: ${data.release_date}</p>
                <p>Score: 
                    ${generateStarRating(data.vote_average)}
                    (${data.vote_average.toFixed(1)}/10)
                </p>
                        <p>Genre: ${data.genres.join(', ')}</p>
                        <p>Runtime: ${Math.floor(data.runtime / 60)}h ${data.runtime % 60}m</p>
                        <div class="financial-box">
                            <p>Budget: $${data.budget.toLocaleString()}</p>
                            <p>Revenue: $${data.revenue.toLocaleString()}</p>
                            <p>Profit: <span class="profit ${data.profit >= 0 ? 'positive' : 'negative'}">
                                $${Math.abs(data.profit).toLocaleString()} ${data.profit >= 0 ? 'profit' : 'loss'}
                            </span></p>
                        </div>
                        <p>Director: ${data.director}</p>
                        <p class="overview">Overview:<br> ${data.overview}</p>
                    </div>
                    <h3>Cast</h3>
                    <div class="cast-list">
                        ${data.cast.map(person => `
                            <div class="cast-member">
                                <img src="${person.profile_path || 'placeholder.jpg'}" alt="${person.name}">
                                <p>${person.name}</p>
                                <p class="castcharacter">${person.character}</p>
                            </div>
                        `).join('')}
                    </div>
                    <h3>Backdrops</h3>
                    <div class="backdrop-container">
                        ${data.backdrops.map(backdrop => `<img src="${backdrop}" alt="Backdrop" class="backdrop" onclick="expandBackdrop('${backdrop}')">`).join('')}
                    </div>
                    <h3>Recommendations</h3>
                    <div class="recommendations">
                        ${data.recommendations.map(rec => `
                            <div class="recommendation" onclick="getMovieDetails(${rec.id})">
                                <img src="${rec.poster}" alt="${rec.title}">
                                <p>${rec.title}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

function generateStarRating(rating) {
    const starTotal = 5;
    const fullStars = Math.round(rating / 1.9);  // Round to nearest whole number
    
    return `<span class="stars">${'<span class="star filled">★</span>'.repeat(fullStars)}${'<span class="star">★</span>'.repeat(starTotal - fullStars)}</span>`;
}


        function expandBackdrop(imageUrl) {
            const expandedBackdrop = document.createElement('div');
            expandedBackdrop.className = 'expanded-backdrop';
            expandedBackdrop.innerHTML = `<img src="${imageUrl}" alt="Expanded Backdrop">`;
            expandedBackdrop.onclick = function() {
                document.body.removeChild(expandedBackdrop);
            };
            document.body.appendChild(expandedBackdrop);
        }
    </script>
</body>
</html>
